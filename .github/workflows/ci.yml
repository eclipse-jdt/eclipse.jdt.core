name: Continuous Integration
concurrency: 
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

on:
  push:
    branches: '**'
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: recursive
        fetch-depth: 0
    - name: Set up JDKs ‚òï
      uses: actions/setup-java@v3
      with:
        java-version: |
          8
          17
          20
        mvn-toolchain-id: |
          JavaSE-1.8
          JavaSE-17
          JavaSE-20
        distribution: 'temurin'
    - name: Set up Maven
      uses: stCarolas/setup-maven@v4.5
      with:
        maven-version: 3.9.3
    - name: Build with Maven üèóÔ∏è
      run: |
        mvn clean install -f org.eclipse.jdt.core.compiler.batch -DlocalEcjVersion=99.99 && mvn -U clean verify --batch-mode --fail-at-end -Ptest-on-javase-20 -Pbree-libs -Papi-check -Djava.io.tmpdir=$WORKSPACE/tmp -Dproject.build.sourceEncoding=UTF-8  -Dtycho.surefire.argLine="--add-modules ALL-SYSTEM --add-exports jdk.compiler/com.sun.tools.javac.jvm=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.code=ALL-UNNAMED  -Dcompliance=1.8,11,17,20 -Djdt.performance.asserts=disabled" -Dcbi-ecj-version=99.99
      env:
        MAVEN_OPTS: --add-exports jdk.compiler/com.sun.tools.javac.jvm=ALL-UNNAMED
        JAVA_OPTS: --add-exports jdk.compiler/com.sun.tools.javac.jvm=ALL-UNNAMED
