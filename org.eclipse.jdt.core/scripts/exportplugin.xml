<?xml version="1.0" encoding="UTF-8"?>

<!-- build script to create a plugin from ${plugin} -->
<project name="${plugin}" default="export plug-in [_3.2.7]" basedir="..">

<target name="export plug-in [_3.2.7]">
    <tstamp/>
	<property name="qualifier" value="z${DSTAMP}-${TSTAMP}" />
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="3.2.7"/>
	</antcall>
</target>
<target name="export plug-in [_3.2.7.qualifier] (with sources)">
    <tstamp/>
	<property name="qualifier" value="${DSTAMP}-${TSTAMP}" />
	<antcall target="zz_internal_export_structure">
		<param name="jdt_core_version" value="3.2.7.${qualifier}"/>
	</antcall>
</target>
<target name="export plug-in [_3.2.7.qualifier]">
    <tstamp/>
	<property name="qualifier" value="z${DSTAMP}-${TSTAMP}" />
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="3.2.7.${qualifier}"/>
	</antcall>
</target>

<target name="export plug-in [_3.1.0]">
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="3.1.0"/>
	</antcall>
</target>

<target name="export plug-in [_3.0.0]">
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="3.0.0"/>
	</antcall>
</target>

<target name="export plug-in [_2.1.1]">
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="2.1.1"/>
	</antcall>
</target>

<target name="export plug-in [_2.1.0]">
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="2.1.0"/>
	</antcall>
</target>

<target name="export plug-in [_2.0.1]">
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="2.0.1"/>
	</antcall>
</target>

<target name="export plug-in [_2.0.0]">
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="2.0.0"/>
	</antcall>
</target>

<target name="export plug-in [_1.9.0]">
	<antcall target="zz_internal_export">
		<param name="jdt_core_version" value="1.9.0"/>
	</antcall>
</target>

<target name="zz_internal_export">

	<tstamp/>
	<property name="export-dir" value="../../plugin-export" />
	<property name="plugin" value="org.eclipse.jdt.core" />
	<property name="plugin-dir" value="${export-dir}/${plugin}_${jdt_core_version}"/>

	<echo message="TARGET: ${export-dir}" />
	<mkdir dir="${export-dir}" />
	<delete dir="${plugin-dir}" />
	<mkdir dir="${plugin-dir}" />

	<echo message="UPDATE jdtCompilerAdapter.jar" />
  	<jar 
		jarfile="${plugin-dir}/jdtCompilerAdapter.jar"
		basedir="antbin"/>

	<echo message="UPDATE ${plugin}_${jdt_core_version}.jar" />
	<copy todir="${plugin-dir}/META-INF">
		<fileset dir="META-INF" />
	</copy>  
	<replaceregexp file="${plugin-dir}/META-INF/MANIFEST.MF" match="Bundle-Version: ((\d)+\.(\d)+\.(\d)+\.)qualifier" replace="Bundle-Version: \1${qualifier}" byline="true" />
	<zip zipfile="${plugin-dir}/${plugin}_${jdt_core_version}.jar">
		<fileset dir=".">
		  <include name="plugin.xml" />
		  <include name="plugin.properties" />
	      <include name=".options"/>
          <include name="about.html"/>
        </fileset>
		<fileset dir="${plugin-dir}">
			<include name="META-INF/**" />
		</fileset>
        <fileset dir="bin" />
        <fileset file="${plugin-dir}/jdtCompilerAdapter.jar"/>
        <zipfileset dir="batch" prefix="src"/>
	    <zipfileset dir="codeassist" prefix="src"/>
	    <zipfileset dir="compiler" prefix="src"/>
	    <zipfileset dir="dom" prefix="src"/>
	    <zipfileset dir="eval" prefix="src"/>
	    <zipfileset dir="formatter" prefix="src"/>
	    <zipfileset dir="model" prefix="src"/>
	    <zipfileset dir="search" prefix="src"/>
	</zip>
	<delete dir="${plugin-dir}/META-INF" />

	<delete file="${plugin-dir}/jdtCompilerAdapter.jar"/>

	<echo message="UPDATE ${export-dir}/../${plugin}_${jdt_core_version}.zip" />
	<zip zipfile="${export-dir}/../${plugin}_${jdt_core_version}.zip"
	    basedir="${export-dir}" 
	    includes="${plugin}_${jdt_core_version}/**"	/>		
	<!--
		<delete dir="${plugin-dir}" />
	-->
</target>

<target name="zz_internal_export_structure">

	<tstamp/>
	<property name="export-dir" value="../../plugin-export" />
	<property name="plugin" value="org.eclipse.jdt.core" />
	<property name="plugin-dir" value="${export-dir}/${plugin}_${jdt_core_version}"/>

	<echo message="TARGET: ${export-dir}" />
	<mkdir dir="${export-dir}" />
	<delete dir="${plugin-dir}" />
	<mkdir dir="${plugin-dir}" />

	<echo message="UPDATE jdtCompilerAdapter.jar" />
  	<jar 
		jarfile="${plugin-dir}/jdtCompilerAdapter.jar"
		basedir="antbin"/>

	<echo message="UPDATE ${plugin}_${jdt_core_version}.jar" />
	<copy todir="${plugin-dir}/META-INF">
		<fileset dir="META-INF" />
	</copy>  
	<replaceregexp file="${plugin-dir}/META-INF/MANIFEST.MF" match="Bundle-Version: ((\d)+\.(\d)+\.(\d)+\.)qualifier" replace="Bundle-Version: \1${qualifier}" byline="true" />
	<zip zipfile="${plugin-dir}/${plugin}_${jdt_core_version}.jar">
		<fileset dir=".">
		  <include name="plugin.xml" />
		  <include name="plugin.properties" />
	      <include name=".options"/>
          <include name="about.html"/>
        </fileset>
		<fileset dir="${plugin-dir}">
			<include name="META-INF/**" />
		</fileset>
        <fileset dir="bin" />
        <fileset file="${plugin-dir}/jdtCompilerAdapter.jar"/>
	</zip>
	<zip zipfile="${plugin-dir}/src.zip">
        <zipfileset dir="batch" includes="**/*.java"/>
	    <zipfileset dir="codeassist" includes="**/*.java"/>
	    <zipfileset dir="compiler" includes="**/*.java"/>
	    <zipfileset dir="dom" includes="**/*.java"/>
	    <zipfileset dir="eval" includes="**/*.java"/>
	    <zipfileset dir="formatter" includes="**/*.java"/>
	    <zipfileset dir="model" includes="**/*.java"/>
	    <zipfileset dir="search" includes="**/*.java"/>		
	</zip>
	<zip zipfile="${plugin-dir}/jdtCompilerAdaptersrc.zip">
        <zipfileset dir="antadapter" includes="**/*.java"/>
	</zip>
	<delete dir="${plugin-dir}/META-INF" />

	<delete file="${plugin-dir}/jdtCompilerAdapter.jar"/>

	<echo message="UPDATE ${export-dir}/../${plugin}_${jdt_core_version}.zip" />
	<zip zipfile="${export-dir}/../${plugin}_${jdt_core_version}.zip"
	    basedir="${export-dir}" 
	    includes="${plugin}_${jdt_core_version}/**"	/>
	<!--
		<delete dir="${plugin-dir}" />
	-->
</target>

</project>
