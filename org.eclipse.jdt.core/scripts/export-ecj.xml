<?xml version="1.0" encoding="UTF-8"?>

<!-- build script to create a batch compiler from org.eclipse.jdt.core -->
<project name="Eclipse Batch Compiler" default="export-all" basedir="..">
	<target name="init">
		<tstamp/>
		<property name="dest" value="../../ecj-export" />
		<property name="ecj-temp-folder" value="${basedir}/ecj-temp-folder" />
	</target>
	
	<target name="extract-batch-compiler" depends="init">
		<property name="target.folder" value="bin"/>
		<echo message="Extract .class file and properties for the batch compiler" />
		<mkdir dir="${ecj-temp-folder}"/>
		<copy todir="${ecj-temp-folder}">
			<fileset dir="scripts">
			   <include name="META-INF/**" />
			   <include name="about.html" />
	        </fileset>
	        <fileset dir="${target.folder}">
	        	<include name="org/eclipse/jdt/internal/compiler/**"/>
	        	<include name="org/eclipse/jdt/core/compiler/**"/>
	        	<exclude name="**/package.htm*"/>
	        	<exclude name="org/eclipse/jdt/core/compiler/CompilationParticipant*.class"/>
	        	<exclude name="org/eclipse/jdt/core/compiler/BuildContext.class"/>
	        	<exclude name="org/eclipse/jdt/core/compiler/IScanner.class"/>
	        	<exclude name="org/eclipse/jdt/core/compiler/ITerminalSymbols*.class"/>
	        	<exclude name="org/eclipse/jdt/core/compiler/ReconcileContext*.class"/>
	        	<exclude name="org/eclipse/jdt/internal/compiler/DocumentElementParser*.class"/>
	        	<exclude name="org/eclipse/jdt/internal/compiler/IDocumentElementRequestor.class"/>
	        	<exclude name="org/eclipse/jdt/internal/compiler/ISourceElementRequestor.class"/>
	        	<exclude name="org/eclipse/jdt/internal/compiler/SourceElementParser*.class"/>
	        	<exclude name="org/eclipse/jdt/internal/compiler/SourceElementRequestorAdapter*.class"/>
	        	<exclude name="org/eclipse/jdt/internal/compiler/SourceJavadocParser*.class"/>
	        	<exclude name="org/eclipse/jdt/internal/compiler/parser/SourceTypeConverter*.class"/>
        	</fileset>
		</copy>		
	</target>

	<target name="extract-ant-adapter-compiler" depends="init">
		<property name="target.folder" value="antbin"/>
		<echo message="Extract .class file and properties for the ant adapter" />
		<mkdir dir="${ecj-temp-folder}"/>
		<copy todir="${ecj-temp-folder}">
	        <fileset dir="${target.folder}">
	        	<exclude name="org/eclipse/jdt/core/CheckDebugAttributes*.*"/>
        	</fileset>
		</copy>
	</target>

	<target name="export" depends="init">
		<mkdir dir="${dest}" />

		<echo message="UPDATE ecj_3.1.3.jar" />
		<delete file="${dest}/ecj_3.1.3.jar" failonerror="false"/>
		<zip zipfile="${dest}/ecj_3.1.3.jar">
			<fileset dir="${ecj-temp-folder}">
				<include name="**/*"/>
				<include name="about.html"/>
	        </fileset>
		</zip>
		<echo message="UPDATE ecjsrc.zip" />
		<delete file="${dest}/ecj_3.1.3src.zip" failonerror="false"/>
		<zip zipfile="${dest}/ecj_3.1.3src.zip">
		    <zipfileset dir="batch" />
		    <zipfileset dir="compiler" />
		    <zipfileset dir="antadapter">
	        	<exclude name="org/eclipse/jdt/core/CheckDebugAttributes.java"/>
		    </zipfileset>
			<zipfileset dir="scripts">
			  <include name="about.html" />
			</zipfileset>			
  		</zip>
		<delete dir="${ecj-temp-folder}" failonerror="false"/>
	</target>
		
	<target name="export-all" depends="init">
		<antcall target="extract-batch-compiler"/>
		<antcall target="extract-ant-adapter-compiler"/>
		<antcall target="export"/>
	</target>
</project>
